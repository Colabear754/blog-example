<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.example.blog.mapper.BoardMapper">
    <select id="getDocuments" resultType="BoardVO">
        select a.*
        from (
            select rownum r, b.*
            from (
                select board.*
                from board
                <if test="category_id!=null">
                    where CATEGORY_ID = #{category_id}
                </if>
                order by reg_time
            ) b
        ) a
        <![CDATA[where r >= #{start} and r <= #{end}]]>
    </select>

    <select id="getDocument" resultType="BoardVO">
        select *
        from board
        where seq = #{seq}
    </select>

    <insert id="write">
        insert into board
        values (DOC_SEQ.nextval, systimestamp, #{category_id}, #{subject}, #{content}, #{thumbnail}, 0, 0)
    </insert>

    <update id="update">
        update board
        set CATEGORY_ID = #{category_id}, SUBJECT = #{subject}, CONTENT = #{content}, THUMBNAIL = #{thumbnail}
        where SEQ = #{seq}
    </update>

    <delete id="delete">
        delete
        from BOARD
        where SEQ = #{seq}
    </delete>

    <select id="isLike" resultType="_boolean">
        select case when count(*) > 0 then 1 else 0 end result
        from LIKE_DOCUMENT
        where ID = #{id} and SEQ = #{seq}
    </select>

    <insert id="like">
        insert into LIKE_DOCUMENT
        values (#{id}, #{seq})
    </insert>

    <delete id="cancelLike">
        delete
        from LIKE_DOCUMENT
        where ID = #{id} and SEQ = #{seq}
    </delete>
</mapper>